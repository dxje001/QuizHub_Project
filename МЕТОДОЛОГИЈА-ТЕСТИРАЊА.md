# 4. МЕТОДОЛОГИЈА ТЕСТИРАЊА ПЕРФОРМАНСИ

У овом поглављу описана је методологија која је коришћена за тестирање и компарацију перформанси монолитне и микросервисне архитектуре апликације КвизХаб.

## 4.1 Циљеви тестирања

Главни циљ перформанс тестирања је квантитативна компарација монолитне и микросервисне архитектуре под реалистичним условима коришћења. Специфични циљеви укључују:

- Мерење времена одзива система под различитим нивоима оптерећења
- Процена пропусности система (throughput)
- Анализа стопе грешака при повећаном оптерећењу
- Евалуација скалабилности обе архитектуре
- Идентификација перформансних bottleneck-а

## 4.2 Алат за тестирање

За спровођење перформанс тестова коришћен је K6, модерни open-source алат за load testing развијен од стране Grafana Labs. K6 је изабран због следећих карактеристика:

- Једноставност коришћења - тестови се пишу у JavaScript-у
- Високе перформансе - способан да генерише велико оптерећење
- Богати metrics - аутоматски прикупља детаљне метрике
- CLI интеграција - лако се извршава из command line-а
- Извоз резултата у JSON формату за даљу анализу

K6 је инсталиран коришћењем winget package manager-а на Windows систему.

## 4.3 Тест сценарији

Дефинисана су три сценарија оптерећења који симулирају различите услове коришћења. Сви сценарији трају 2 минута и користе constant-vus executor (константан број виртуелних корисника).

### 4.3.1 Лако оптерећење (Light Load)

- **Број корисника**: 5 виртуелних корисника
- **Трајање**: 2 минута
- **Сврха**: Мерење базних перформанси без значајног оптерећења

### 4.3.2 Средње оптерећење (Medium Load)

- **Број корисника**: 20 виртуелних корисника
- **Трајање**: 2 минута
- **Сврха**: Симулација типичног оптерећења у редовној употреби

### 4.3.3 Тешко оптерећење (Heavy Load)

- **Број корисника**: 50 виртуелних корисника
- **Трајање**: 2 минута
- **Сврха**: Тестирање система под великим оптерећењем

## 4.4 Симулација корисничког понашања

Тест скрипта симулира реалистично понашање корисника који користи апликацију. Сваки виртуелни корисник извршава следећу секвенцу акција у циклусу:

1. **Преглед свих квизова** - GET `/api/quiz`
2. **Преглед категорија** - GET `/api/category`
3. **Преглед детаља квиза** - GET `/api/quiz/{id}`
4. **Health check** - GET `/health`

После сваке акције следи пауза од 1 секунде, што симулира природно понашање корисника. Користи се реални ID квиза из базе података (`1f645276-d6bc-4901-8774-5d8af1e13396`).

## 4.5 Метрике перформанси

K6 аутоматски прикупља следеће кључне метрике:

**Време одзива (http_req_duration)**:
- Просечно време (avg)
- Медијана (med)
- 95-ти перцентил (p95)
- 99-ти перцентил (p99)

**Пропусност (throughput)**:
- Број захтева по секунди (http_reqs rate)

**Стопа грешака (error rate)**:
- Проценат неуспелих захтева (http_req_failed)

Перцентилне вредности су посебно важне јер показују доживљај корисника у најгорим случајевима, не само просечне перформансе.

## 4.6 Тестна окружења

### 4.6.1 Монолитна архитектура - локално окружење

Монолитна верзија апликације deployована је локално коришћењем Docker Compose-а:

- **Окружење**: Локална Windows машина
- **Deployовање**: Docker Compose
- **База података**: PostgreSQL 15 контејнер
- **Base URL**: `http://localhost:5000`
- **Мрежа**: Localhost (loopback интерфејс, минимална латенција < 1ms)

### 4.6.2 Микросервисна архитектура - AWS окружење

Микросервисна верзија deployована је на Amazon Web Services облаку:

- **Окружење**: AWS EC2 инстанца (t2/t3.medium)
- **Elastic IP**: `44.208.207.182`
- **Базе података**: Три AWS RDS PostgreSQL инстанце
- **Region**: us-east-1 (North Virginia)
- **Base URL**: `http://44.208.207.182`
- **Мрежа**: Комуникација преко јавног интернета
- **Компоненте**: Nginx API Gateway + 3 микросервиса (AuthService, QuizService, ExecutionService)

### 4.6.3 Клијентско окружење

K6 тестови извршавани су са исте локалне машине на којој је deployован монолит. Ово значи:

- **Монолит**: K6 и апликација на истој машини, минимална мрежна латенција
- **Микросервиси**: K6 локално, апликација на AWS-у, значајна мрежна латенција

Ова разлика је намерна и реалистична - монолитне апликације се често deployују на private servers, док микросервиси често користе cloud инфраструктуру.

## 4.7 Извршавање тестова

Извршено је укупно 6 тестова (3 сценарија × 2 архитектуре):

1. Монолит - Light Load
2. Монолит - Medium Load
3. Монолит - Heavy Load
4. Микросервиси - Light Load
5. Микросервиси - Medium Load
6. Микросервиси - Heavy Load

**Пример команде за покретање теста**:

```bash
"C:\Program Files\k6\k6.exe" run test-scenarios.js \
  --env BASE_URL=http://localhost:5000 \
  --env TEST_NAME=monolith \
  --env SCENARIO=heavy_load \
  --out json=results-monolith-heavy_load.json
```

Резултати сваког теста сачувани су у засебном JSON фајлу за даљу анализу.

## 4.8 Анализа и визуелизација резултата

По завршетку тестирања, резултати су обрађени коришћењем Python скрипте (`generate-graphs.py`) која:

1. Учитава све JSON фајлове са резултатима
2. Екстрактује кључне метрике
3. Генерише графичке приказе са српским ћириличним ознакама
4. Израчунава процентуалне разлике између архитектура

Генерисана су четири графика:
- Поређење просечног времена одзива
- Поређење пропусности система
- Поређење стопе грешака
- Поређење p95 времена одзива

Сви графици су линијски дијаграми са резолуцијом 300 DPI, погодни за укључивање у дипломски рад.

## 4.9 Ограничења методологије

**Разлике у тестном окружењу** - Монолит је тестиран локално, а микросервиси на AWS-у, што уводи разлику у мрежној латенцији. Међутим, ова разлика одражава реалне deployment сценарије.

**Једноставност сценарија** - Тестиране су само read операције (GET захтеви). Write операције (POST, PUT, DELETE) нису укључене у тестове.

**Одсуство аутентификације** - Тестови не укључују аутентификацију корисника како би се фокус задржао на архитектурним разликама.

**Кратко трајање** - Тестови трају по 2 минута, што је довољно за базно поређење али не открива проблеме који се манифестују током дужег периода.

Упркос овим ограничењима, методологија обезбеђује валидно поређење две архитектуре и омогућава извлачење значајних закључака о њиховим перформансним карактеристикама.
